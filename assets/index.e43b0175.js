var b=Object.defineProperty;var x=(o,e,s)=>e in o?b(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var a=(o,e,s)=>(x(o,typeof e!="symbol"?e+"":e,s),s);import{S as z,V as c,O as S,A as j,p as d,aG as p,M as m,D as w,a as C,W as y}from"./three.module.aa667966.js";import{m as v,q as P,f as k,g as M,o as f,c as g,a as h,t as _,k as A,s as B,p as W,b as D,_ as F}from"./index.ca067ba1.js";class R{constructor(){a(this,"config");a(this,"isMobile");a(this,"score");a(this,"size");a(this,"canvas");a(this,"scene");a(this,"camera");a(this,"renderer");a(this,"cameraPos");a(this,"cubes");a(this,"jumper");a(this,"cubeState");a(this,"jumperState");a(this,"falledState");a(this,"fallingState");a(this,"successCallback");a(this,"failedCallback");this.config={background:2631720,ground:-1,fallingSpeed:.2,cubeColor:12500670,cubeWidth:4,cubeHeight:2,cubeDeep:4,jumperColor:2302755,jumperWidth:1,jumperHeight:2,jumperDeep:1},this.isMobile=!1,this.score=0,this.size={width:window.innerWidth,height:window.innerHeight},this.scene=new z,this.cameraPos={current:new c(0,0,0),next:new c},this.camera=new S(this.size.width/-80,this.size.width/80,this.size.height/80,this.size.height/-80,0,5e3),this.cubes=[],this.cubeState={nextDir:""},this.jumperState={ready:!1,xSpeed:0,ySpeed:0},this.falledState={location:-1,distance:0},this.fallingState={speed:.2,end:!1},this.successCallback=()=>null,this.failedCallback=()=>null,this.canvas=this._setCanvas(),this.renderer=this._setRenderer()}init(){this._checkUserAgent(),this._setCamera(),this._setRenderer(),this._setLight(),this._createCube(),this._createCube(),this._createJumper(),this._updateCamera(),window.addEventListener("resize",()=>{this._handleWindowResize()})}restart(){this.score=0,this.cameraPos={current:new c(0,0,0),next:new c},this.fallingState={speed:.2,end:!1};const e=this.cubes.length;for(let s=0;s<e;s++)this.scene.remove(this.cubes.pop());this.scene.remove(this.jumper),this.successCallback(this.score),this._createCube(),this._createCube(),this._createJumper(),this._updateCamera()}addSuccessFn(e){this.successCallback=e}addFailedFn(e){this.failedCallback=e}_checkUserAgent(){const e=navigator.userAgent;(e.match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone/i)||e.match(/iPad/i)||e.match(/iPod/i)||e.match(/BlackBerry/i))&&(this.isMobile=!0)}_createHelpers(){const e=new j(10);this.scene.add(e)}_setCanvas(){const e=document.querySelector("canvas");if(!e)throw Error("canvas is not ready");const s=this.isMobile?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"};return e.addEventListener(s.down,()=>{this._handleMousedown()}),e.addEventListener(s.up,t=>{this._handleMouseup()}),e}_handleWindowResize(){this._setSize(),this.camera.left=this.size.width/-80,this.camera.right=this.size.width/80,this.camera.top=this.size.height/80,this.camera.bottom=this.size.height/-80,this.camera.updateProjectionMatrix(),this.renderer&&this.renderer.setSize(this.size.width,this.size.height),this._render()}_handleMousedown(){!this.jumperState.ready&&this.jumper.scale.y>.02&&(this.jumper.scale.y-=.01,this.jumperState.xSpeed+=.004,this.jumperState.ySpeed+=.008,this._render(),requestAnimationFrame(()=>{this._handleMousedown()}))}_handleMouseup(){this.jumperState.ready=!0,this.jumper.position.y>=1?(this.cubeState.nextDir==="left"?this.jumper.position.x-=this.jumperState.xSpeed:this.jumper.position.z-=this.jumperState.xSpeed,this.jumper.position.y+=this.jumperState.ySpeed,this.jumper.scale.y<1&&(this.jumper.scale.y+=.02),this.jumperState.ySpeed-=.01,this._render(),requestAnimationFrame(()=>{this._handleMouseup()})):(this.jumperState.ready=!1,this.jumperState.xSpeed=0,this.jumperState.ySpeed=0,this.jumper.position.y=1,this._checkInCube(),this.falledState.location===1?(this.score++,this._createCube(),this._updateCamera(),this.successCallback&&this.successCallback(this.score)):this._falling())}_fallingRotate(e){const s=this.falledState.distance-this.config.cubeWidth/2;let t="z",i=this.jumper.rotation[t]+.1,n=this.jumper.rotation[t]<Math.PI/2,r=this.config.ground+this.config.jumperWidth/2+s;if(e==="rightTop")t="x",i=this.jumper.rotation[t]-.1,n=this.jumper.rotation[t]>-Math.PI/2,this.jumper.geometry.translate.z=s;else if(e==="rightBottom")t="x",i=this.jumper.rotation[t]+.1,n=this.jumper.rotation[t]<Math.PI/2,this.jumper.geometry.translate.z=-s;else if(e==="leftBottom")t="z",i=this.jumper.rotation[t]-.1,n=this.jumper.rotation[t]>-Math.PI/2,this.jumper.geometry.translate.x=-s;else if(e==="leftTop")t="z",i=this.jumper.rotation[t]+.1,n=this.jumper.rotation[t]<Math.PI/2,this.jumper.geometry.translate.x=s;else if(e==="none")n=!1,r=this.config.ground;else throw Error("Arguments Error");this.fallingState.end?this.failedCallback&&this.failedCallback():(n?this.jumper.rotation[t]=i:this.jumper.position.y>r?this.jumper.position.y-=this.config.fallingSpeed:this.fallingState.end=!0,this._render(),requestAnimationFrame(()=>{this._falling()}))}_falling(){this.falledState.location==0?this._fallingRotate("none"):this.falledState.location===-10?this.cubeState.nextDir=="left"?this._fallingRotate("leftTop"):this._fallingRotate("rightTop"):this.falledState.location===10&&(this.cubeState.nextDir=="left"?this.jumper.position.x<this.cubes[this.cubes.length-1].position.x?this._fallingRotate("leftTop"):this._fallingRotate("leftBottom"):this.jumper.position.z<this.cubes[this.cubes.length-1].position.z?this._fallingRotate("rightTop"):this._fallingRotate("rightBottom"))}_checkInCube(){if(this.cubes.length>1){const e={x:this.jumper.position.x,z:this.jumper.position.z},s={x:this.cubes[this.cubes.length-1-1].position.x,z:this.cubes[this.cubes.length-1-1].position.z},t={x:this.cubes[this.cubes.length-1].position.x,z:this.cubes[this.cubes.length-1].position.z};let i,n;this.cubeState.nextDir==="left"?(i=Math.abs(e.x-s.x),n=Math.abs(e.x-t.x)):(i=Math.abs(e.z-s.z),n=Math.abs(e.z-t.z));let r=this.config.cubeWidth/2+this.config.jumperWidth/2,l=0;i<r?(this.falledState.distance=i,l=i<this.config.cubeWidth/2?-1:-10):n<r?(this.falledState.distance=n,l=n<this.config.cubeWidth/2?1:10):l=0,this.falledState.location=l}}_updateCameraPos(){const e=this.cubes.length-1,s={x:this.cubes[e].position.x,z:this.cubes[e].position.z},t={x:this.cubes[e-1].position.x,z:this.cubes[e-1].position.z},i=new c;i.x=(s.x+t.x)/2,i.y=0,i.z=(s.z+t.z)/2,this.cameraPos.next=i}_updateCamera(){const e={x:this.cameraPos.current.x,y:this.cameraPos.current.y,z:this.cameraPos.current.z},s={x:this.cameraPos.next.x,y:this.cameraPos.next.y,z:this.cameraPos.next.z};(e.x>s.x||e.z>s.z)&&(this.cameraPos.current.x-=.1,this.cameraPos.current.z-=.1,this.cameraPos.current.x-this.cameraPos.next.x<.05&&(this.cameraPos.current.x=this.cameraPos.next.x),this.cameraPos.current.z-this.cameraPos.next.z<.05&&(this.cameraPos.current.z=this.cameraPos.next.z),this.camera.lookAt(new c(e.x,0,e.z)),this._render(),requestAnimationFrame(()=>{this._updateCamera()}))}_createJumper(){const e=new d({color:this.config.jumperColor}),s=new p(this.config.jumperWidth,this.config.jumperHeight,this.config.jumperDeep);s.translate(0,1,0);const t=new m(s,e);t.position.y=1,this.jumper=t,this.scene.add(this.jumper)}_createCube(){const e=new d({color:this.config.cubeColor}),s=new p(this.config.cubeWidth,this.config.cubeHeight,this.config.cubeDeep),t=new m(s,e);if(this.cubes.length){const i=Math.random();this.cubeState.nextDir=i>.5?"left":"right",t.position.x=this.cubes[this.cubes.length-1].position.x,t.position.y=this.cubes[this.cubes.length-1].position.y,t.position.z=this.cubes[this.cubes.length-1].position.z,this.cubeState.nextDir==="left"?t.position.x=this.cubes[this.cubes.length-1].position.x-4*Math.random()-6:t.position.z=this.cubes[this.cubes.length-1].position.z-4*Math.random()-6}this.cubes.push(t),this.cubes.length>6&&this.scene.remove(this.cubes.shift()),this.scene.add(t),this.cubes.length>1&&this._updateCameraPos()}_render(){this.renderer&&this.renderer.render(this.scene,this.camera)}_setLight(){const e=new w(16777215,1.1);e.position.set(3,10,5),this.scene.add(e);const s=new C(16777215,.3);this.scene.add(s)}_setCamera(){this.camera.position.set(100,100,100),this.camera.lookAt(this.cameraPos.current)}_setRenderer(){const e=new y({antialias:!0,canvas:this.canvas});return e.setSize(this.size.width,this.size.height),e.setClearColor(this.config.background),e}_setSize(){this.size.width=window.innerWidth,this.size.height=window.innerHeight}}const u=o=>(W("data-v-d7296f23"),o=o(),D(),o),I={class:"container"},L={key:0,class:"mask"},H={class:"content"},T={class:"score-container"},E=u(()=>h("p",{class:"title"},"\u672C\u6B21\u5F97\u5206",-1)),q={class:"score"},J={class:"info"},V=u(()=>h("a",{class:"title",href:"https://github.com/luosijie/threejs-examples",target:"_blank"}," Jump ",-1)),G=u(()=>h("a",{class:"author",href:"https://luosijie.github.io/",target:"_blank"}," Created By Jesse Luo ",-1)),O={class:"score-gaming"},N={class:"score-current"},U=u(()=>h("canvas",null,null,-1)),K=v({__name:"index",setup(o){const e=P(0),s=k({final:{visible:!1}});let t;const i=()=>{s.final.visible=!1,t&&t.restart()};return M(()=>{t=new R,t.addSuccessFn(()=>{e.value=t.score}),t.addFailedFn(()=>{e.value=t.score,s.final.visible=!0}),t.init()}),(n,r)=>(f(),g("div",I,[s.final.visible?(f(),g("div",L,[h("div",H,[h("div",T,[E,h("p",q,_(e.value),1)]),h("button",{class:"restart",onClick:i}," \u91CD\u65B0\u5F00\u59CB ")])])):A("",!0),h("div",J,[V,G,h("div",O,[B(" \u5F97\u5206\uFF1A"),h("span",N,_(e.value),1)])]),U]))}});const Z=F(K,[["__scopeId","data-v-d7296f23"]]);export{Z as default};
