<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MiniCity</title>
  <style>
    body{
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
  <script src="js/libs/three.min.js"></script>
  <script src="js/libs/orbitControls.js"></script>
  <script src="js/libs/stats.min.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/textures.js"></script>
  <script>
    var scene, camera
    var renderer
    var width, width
  
    width = window.innerWidth
    height = window.innerHeight

    scene = new THREE.Scene()
    camera = new THREE.PerspectiveCamera(45, width / height, 1, 5000)
    camera.position.set(300,300,300)
    camera.lookAt(scene.position)
    scene.add(camera)

    renderer = new THREE.WebGLRenderer()
    renderer.setSize(width, height)
    renderer.setClearColor(0x282828)
    document.body.appendChild(renderer.domElement)

    createAuxSystem()
    createLightSystem()
    createbuilding()
    createRoad()
    loop()
    onWindowResize()

    function createRoad () {
      var road = new THREE.Object3D()
      var roadColor = 0xffffff
      var roadBorderOuterCoords = [
        [-150, 150], [150, 150], [150, -150], [-150, -150],
      ]
      var roadBorderOuterHoleCoords = [
        [-149, 149], [-149,-149],[149, -149], [148, 149]
      ]
      var roadBorderOuterShape = utils.makeShape(roadBorderOuterCoords, roadBorderOuterHoleCoords)
      var roadBorderOuterGeometry = utils.makeExtrudeGeometry(roadBorderOuterShape, 0.1)
      var roadBorderOuter = utils.makeMesh('phong', roadBorderOuterGeometry, roadColor)
      road.add(roadBorderOuter)

      var roadBorderInnerCoords = [
        [-131, 131], [-131,  -131], [ 131,  -131], [ 131, 131],
        [ 19 , 131], [ 19 , 99], [ 99, 99], [ 99,  -99],
        [-99,  -99], [-99, 99], [-19,  99 ], [-19,  131 ]
      ]
      var roadBorderInnerShape = utils.makeShape(roadBorderInnerCoords)
      var roadBorderInnnerGeometry = utils.makeExtrudeGeometry(roadBorderInnerShape, 0.1)
      var roadBoaderInnder = utils.makeMesh('phong', roadBorderInnnerGeometry, roadColor)
      roadBoaderInnder.rotation.y = Math.PI
      road.add(roadBoaderInnder)

      var roadLineGeometry = new THREE.CubeGeometry(20, 0.1, 2)
      roadLineGeometry.translate(20,0,0)
      var roadLine = utils.makeMesh('phong', roadLineGeometry, roadColor)
      var roadLines = new THREE.Object3D()
      for( var i =0; i < 9; i++){
          var roadLlineCopy = roadLine.clone()
          roadLlineCopy.translateX(i*30)
          roadLines.add(roadLlineCopy)
      }

      var roadLinesBottom = roadLines.clone()
      roadLinesBottom.position.z = 140
      roadLinesBottom.position.x = -140
      road.add(roadLinesBottom)

      var roadLinesTop = roadLinesBottom.clone()
      roadLinesTop.position.z = -140
      road.add(roadLinesTop)

      var roadLinesLeft = roadLines.clone()
      roadLinesLeft.rotation.y = 0.5 * Math.PI
      roadLinesLeft.position.x = -140
      roadLinesLeft.position.z = 140
      road.add(roadLinesLeft)

      var roadLinesRight = roadLinesLeft.clone()
      roadLinesLeft.position.x = 140
      road.add(roadLinesLeft)

      scene.add(road)
    }

    function createbuilding () {
      var planeGeometry = new THREE.BoxGeometry(300,6,300)
      var planeMaterial = new THREE.MeshLambertMaterial({color: 0x6f5f6a})
      var plane = new THREE.Mesh(planeGeometry, planeMaterial)
      plane.position.y = -3
      scene.add(plane)


      addFense()
      addGreen()
      addTrees()
      addHospital()
      addLamps()

      function addLamps () {
        var lampCoords = [
          [-12.5, 12.5, 41], [-7.5, 12.5, 1], [-2.5, 12.5, 1], [2.5, 12.5, 1], [7.5, 12.5, 1], 
          [12.5, 12.5, 12], [12.5, 7.5, 2], [12.5, 2.5, 2], [12.5, -2.5, 2], [12.5, -7.5, 2], 
          [12.5, -12.5, 23], [7.5, -12.5, 3], [2.5, -12.5, 3], [-2.5, -12.5, 3], [-7.5, -12.5, 3],
          [-12.5, -12.5, 34], [-12.5, -7.5, 4], [-12.5, -2.5, 4], [-12.5, 2.5, 4], [-12.5, 7.5, 4],   
        ]
        
        for (var i = 0; i < lampCoords.length; i++) {
          var p = lampCoords[i]
          var x = p[0] * 10, 
              z = p[1] * 10, 
              r = p[2]
          switch (r) {
            case 1 : r = -0.5 * Math.PI
              break;
            case 12 : r = -0.25 * Math.PI
              break;
            case 2 : r = 0
              break;
            case 23 : r = 0.25 * Math.PI
              break;
            case 3 : r = 0.5 * Math.PI
              break;
            case 34 : r = 0.75 * Math.PI
              break;
            case 4 : r = Math.PI
              break;
            case 41: r = 1.25 * Math.PI
          } 
          var lamp = new Lamp()
          lamp.rotation.y = r
          lamp.position.set(x,0,z)
          scene.add(lamp)
        }
      }

      function addHospital () {
        var hospital = new Hospital()
        hospital.position.z = -20
        scene.add(hospital)  
      }

      function addGreen () {
        var greenCoords = [
          [-120, -120], [-120,  120], [ 120,  120], [ 120, -120],
          [ 20 , -120], [ 20 , -100], [ 100, -100], [ 100,  100],
          [-100,  100], [-100, -100], [-20,  -100 ], [-20,  -120 ],
          [-120, -120]
        ]
        var greenShape = utils.makeShape(greenCoords)

        var greenGeometry = utils.makeExtrudeGeometry(greenShape, 3)
        var green = utils.makeMesh('lambert', greenGeometry, 0xc0c06a)
        scene.add(green)


      }

      function addFense () {
        var fenseCoords = [
          [-130, -130], [-130, 130], [ 130,  130], [ 130, -130],
          [ 20, -130], [ 20, -120], [ 120, -120], [ 120, 120],
          [-120, 120], [-120, -120], [-20,  -120 ], [-20,  -130 ],
          [-130, -130]
        ]
        var fenseShape = utils.makeShape(fenseCoords)
        
        var fenseGeometry = utils.makeExtrudeGeometry(fenseShape, 3)
        var fense = utils.makeMesh('lambert', fenseGeometry, 0xe5cabf)
        scene.add(fense)
      }
      
      function addTrees () {
        var treeCoords = [
          [-110, -110], [-90, -110],[-70, -110],[-50, -110],[-30, -110],[ -10, -110],[10, -110],[30, -110],[50, -110],[70, -110],[90, -110],
          [-110,  110], [-110, 90],[-110, 70],[-110, 50],[-110, 30],[ -110, 10],[-110, -10],[-110, -30],[-110, -50],[-110, -70],[-110, -90],
          [ 110,  110], [90, 110], [70, 110], [50, 110], [30, 110],[-30, 110], [-50, 110], [-70, 110], [-90, 110],
          [ 110, -110], [ 110, -90], [ 110, -70], [ 110, -50], [ 110, -30], [ 110, -10], [ 110, 10], [ 110, 30], [ 110, 50], [ 110, 70],  [ 110, 90],
        ]
        for (var i = 0; i < treeCoords.length; i++) {
          var treeX = treeCoords[i][0],
              treeY = 3,
              treeZ = treeCoords[i][1]
          var tree = new Tree(treeCoords[i][0], 1, treeCoords[i][1])
          scene.add(tree)
        }
      }

      function Lamp () {
        this.lamp = new THREE.Object3D()
        var pillarGeomertry = new THREE.CubeGeometry(2, 30, 2)
        pillarGeomertry.translate(0, 15, 0)
        var pillar = utils.makeMesh('phong', pillarGeomertry, 0xebd1c2)
        this.lamp.add(pillar)

        var connectGeometry = new THREE.CubeGeometry(10,1,1)
        var connect = utils.makeMesh('phong', connectGeometry, 0x2c0e0e)
        connect.position.set(3, 30, 0)
        this.lamp.add(connect)

        var lightGeometry = new THREE.CubeGeometry(6,2,4)
        light = utils.makeMesh('phong', lightGeometry, 0xebd1c2)
        light.position.set(10, 30, 0)
        this.lamp.add(light)

        return this.lamp
      }
      
      function Hospital () {
        this.hospital = new THREE.Object3D()

        var baseGeometry = new THREE.BoxGeometry(180, 3, 140)
        var base = utils.makeMesh('lambert', baseGeometry, 0xffffff)
        base.position.y = 1
        this.hospital.add(base)

        var frontMainCoords = [
          [-80, -30], [-80, 20], [50, 20], [50, 0], [20, -30], [-80, -30]
        ]
        var frontMainShape = utils.makeShape(frontMainCoords)
        var frontMainGeometry = utils.makeExtrudeGeometry(frontMainShape,100)
        var frontMainMaterial = new THREE.MeshPhongMaterial({map: textures.window()})
        frontMainMaterial.map.repeat.set(0.1, 0.08)
        var frontMain = new THREE.Mesh(frontMainGeometry, frontMainMaterial)
        this.hospital.add(frontMain)

        var frontTopShape = frontMainShape
        var frontTopGeometry = utils.makeExtrudeGeometry(frontTopShape, 5)
        var frontTop = utils.makeMesh('lambert', frontTopGeometry, 0xb1a7af)
        frontTop.position.y = 100
        this.hospital.add(frontTop)

        var frontRoofs = new THREE.Object3D()
        var frontRoofShelfCubeGeometryZ = new THREE.CubeGeometry(2, 2, 40)
        var frontRoofShelfCubeZ = utils.makeMesh('phong', frontRoofShelfCubeGeometryZ, 0xffffff)
        var frontRoofShelfCubeX = frontRoofShelfCubeZ.clone()
        frontRoofShelfCubeX.rotation.y = 0.5 * Math.PI
        frontRoofShelfCubeX.scale.set(1,1,1.6)
        frontRoofShelfCubeX.position.x = 27
        frontRoofShelfCubeX.position.z = -15
        var frontRoofShelfCubeY = frontRoofShelfCubeZ.clone()
        frontRoofShelfCubeY.scale.z = 0.4
        frontRoofShelfCubeY.position.z =-15
        frontRoofShelfCubeY.position.y = -3
        frontRoofShelfCubeY.rotation.x = 0.5 * Math.PI
        for (var i = 0; i < 12; i++) {
          var frontRoofShelfCube = frontRoofShelfCubeZ.clone()
          frontRoofShelfCube.translateX(i * 5)
          frontRoofs.add(frontRoofShelfCube)
        }
        for (var i = 0; i < 2; i++) {
          var frontRoofShelfCube = frontRoofShelfCubeX.clone()
          frontRoofShelfCube.translateX(-i * 30)
          frontRoofs.add(frontRoofShelfCube)
        }
        var frontRoofShelfCubeYPosition = [[0,0], [1,0], [0, 1], [1,1]]
        for (var i = 0; i < frontRoofShelfCubeYPosition.length; i++) {
          var p = frontRoofShelfCubeYPosition[i]
          var frontRoofShelfCube = frontRoofShelfCubeY.clone()
          frontRoofShelfCube.translateX(p[0] * 55)
          frontRoofShelfCube.translateY(p[1] * 30)
          frontRoofs.add(frontRoofShelfCube)
        }
        frontRoofs.position.set(-70, 115, 5)
        this.hospital.add(frontRoofs)

        var frontPlatGeometry = new THREE.BoxGeometry(150,3,90)
        var fronPlat = utils.makeMesh('lambert', frontPlatGeometry, 0x0792a5)
        fronPlat.position.set(-3,18,25)
        this.hospital.add(fronPlat)

        var frontPlatVerticalGeometry = new THREE.BoxGeometry(150, 15, 3)
        var frontPlatVertical = utils.makeMesh('phong', frontPlatVerticalGeometry, 0x0792a5)
        frontPlatVertical.position.set(-3, 27, 68.5)
        this.hospital.add(frontPlatVertical)

        var frontPlatVerticalWhiteGeometry = new THREE.BoxGeometry(150, 3, 3)
        var frontPlatVerticalWhite = utils.makeMesh('phong', frontPlatVerticalWhiteGeometry, 0xffffff)
        frontPlatVerticalWhite.position.set(-3, 36, 68.5)
        this.hospital.add(frontPlatVerticalWhite)

        var frontPlatPillarGeometry = new THREE.CylinderGeometry(2, 2, 15, 32)
        var frontPlatPillar = utils.makeMesh('lambert', frontPlatPillarGeometry, 0xffffff)
        frontPlatPillar.position.set(-60, 10, 55)
        this.hospital.add(frontPlatPillar)

        var frontPlatPillar2 = frontPlatPillar.clone()
        frontPlatPillar2.position.set(55, 10, 55)
        this.hospital.add(frontPlatPillar2)


        var frontBorderVerticles = new THREE.Object3D()
        var frontBorderVerticleGeometry = new THREE.BoxGeometry(4, 106, 4)
        var frontBorderVerticleMesh = utils.makeMesh('phong', frontBorderVerticleGeometry, 0xffffff)
        var frontBorderVerticle1 = frontBorderVerticleMesh.clone()
        frontBorderVerticle1.position.set(-80, 52, 30)
        frontBorderVerticles.add(frontBorderVerticle1)
        var frontBorderVerticle2 = frontBorderVerticleMesh.clone()
        frontBorderVerticle2.position.set(-80, 52, -20)
        frontBorderVerticles.add(frontBorderVerticle2)
        var frontBorderVerticle3 = frontBorderVerticleMesh.clone()
        frontBorderVerticle3.position.set(50, 52, -18)
        frontBorderVerticles.add(frontBorderVerticle3)
        this.hospital.add(frontBorderVerticles)

        var frontRoofCoords = [
          [-82, -32], [20, -32], [52,0],[52, 22],[-82,22],[-82,-32]
        ]
        var frontRoofHolePath = [
          [-78, -28], [20, -28], [48,0],[48, 18],[-78,18],[-78,-28]
        ]
        var frontRoofShape = utils.makeShape(frontRoofCoords, frontRoofHolePath)
        var frontRoofGeometry = utils.makeExtrudeGeometry(frontRoofShape, 8)
        var frontRoof = utils.makeMesh('phong', frontRoofGeometry, 0xffffff)
        frontRoof.position.y = 100
        this.hospital.add(frontRoof)


        var backMainCoords = [
          [-80, 20], [-80, 60], [80, 60], [80, 20], [-80, 20]
        ]
        var backMainHolePath = [
          [-78, 22], [78, 22], [78, 58], [-78, 58], [-78, 22]
        ]
        var backMainShape = utils.makeShape(backMainCoords, backMainHolePath)

        var backMainGeometry = utils.makeExtrudeGeometry(backMainShape, 90)
        var backMain = utils.makeMesh('lambert', backMainGeometry, 0xf2e21b)
        this.hospital.add(backMain)

        var backMiddleCoords = [
          [0, 0], [36, 0], [36, 70], [0,70],[0,0]
        ]
        var backMiddleHolePath = [
          [2,2], [34, 2], [34, 68], [2, 68], [2, 2]
        ]
        var backMiddleShape = utils.makeShape(backMiddleCoords, backMiddleHolePath)
        var backMiddkeGeometry = utils.makeExtrudeGeometry(backMiddleShape, 165)
        var backMiddle = utils.makeMesh('lambert', backMiddkeGeometry, 0xffffff)
        backMiddle.rotation.x = -0.5 * Math.PI
        backMiddle.rotation.z = -0.5 * Math.PI
        backMiddle.position.y = 86
        backMiddle.position.z = -58
        backMiddle.position.x = -78
        this.hospital.add(backMiddle)

        var backMiddleWindowGeometry = new THREE.PlaneGeometry(32,66,1,1)
        var backMiddleWindowMaterial = new THREE.MeshPhongMaterial({map: textures.window()})
        backMiddleWindowMaterial.map.repeat.set(2,6)

        var backMiddleWindow = new THREE.Mesh(backMiddleWindowGeometry, backMiddleWindowMaterial)
        backMiddleWindow.position.set(83, 51, -40)
        backMiddleWindow.rotation.y = 0.5 * Math.PI
        this.hospital.add(backMiddleWindow)

        var windowBackOrigin = new Window()
        windowBackOrigin.scale.set(0.6,0.6,1)
        windowBackOrigin.rotation.y = Math.PI
        windowBackOrigin.position.set(65, 75, -61)

        for (var i = 0; i < 7; i++) {
          for (var j = 0; j < 4; j++) {
            var windowObj = windowBackOrigin.clone()
            windowObj.position.x -= i * 22
            windowObj.position.y -= j * 20
            this.hospital.add(windowObj)
          }
        }


        return this.hospital
      }

      function Window () {
        this.window = new THREE.Object3D()
        var glassGeometry = new THREE.PlaneGeometry(20, 20)
        var glass = utils.makeMesh('phong', glassGeometry, 0x6a5e74)
        this.window.add(glass)

        var windowBorderGeometry = new THREE.CubeGeometry(22,2,2)
        var windowBorder = utils.makeMesh('phong', windowBorderGeometry, 0xffffff)

        var windowBorderTop = windowBorder.clone()
        windowBorderTop.position.y = 10
        this.window.add(windowBorderTop)

        var windowBorderBottom = windowBorder.clone()
        windowBorderBottom.position.y = -10
        this.window.add(windowBorderBottom)

        var windowBorderLeft = windowBorder.clone()
        windowBorderLeft.rotation.z = 0.5 * Math.PI
        windowBorderLeft.position.x = -10
        this.window.add(windowBorderLeft)

        var windowBorderRight = windowBorderLeft.clone()
        windowBorderRight.position.x = 10
        this.window.add(windowBorderRight)

        return this.window
      }

      function Tree (x, y, z) {
        var x = x || 0
        var y = y || 0
        var z = z || 0

        this.tree = new THREE.Object3D()
        
        var treeTrunkGeometry = new THREE.BoxGeometry(2,16,2)
        var treeTrunkMaterial = new THREE.MeshLambertMaterial({color: 0x8a613a})
        var treeTrunk = new THREE.Mesh(treeTrunkGeometry, treeTrunkMaterial)
        treeTrunk.position.y = 8
        this.tree.add(treeTrunk)

        var treeLeafsGeometry = new THREE.BoxGeometry(8, 8, 8)
        var treeLeafsMaterial = new THREE.MeshLambertMaterial({color: 0x9c9e5d})
        var treeLeafs = new THREE.Mesh(treeLeafsGeometry, treeLeafsMaterial)
        treeLeafs.position.y = 13
        this.tree.add( treeLeafs)

        this.tree.position.set(x, y, z)

        return this.tree
      }
    }
    
    function createLightSystem () {
      var hemisphereLight = new THREE.HemisphereLight( 0xffffff, 1)
      scene.add( hemisphereLight)

      // var directionalLight = new THREE.DirectionalLight( 0xffffff, 0.01 );
      // directionalLight.position.set(0,100,0)
      // scene.add( directionalLight )

    }

    function createAuxSystem () {
      var stats = new Stats()
      stats.setMode(0)
      stats.domElement.style.position = 'absolute'
      stats.domElement.style.left = '5px'
      stats.domElement.style.top = '5px'
      document.body.appendChild(stats.domElement)

      var axisHelper = new THREE.AxesHelper(200)
      scene.add(axisHelper)

      var gridHelper = new THREE.GridHelper(300, 30)
      scene.add(gridHelper)

      var controls = new THREE.OrbitControls(camera, renderer.domElement)
      controls.enableDamping = true 
      controls.dampingFactor = 0.25
      controls.rotateSpeed = 0.35
    }
    function loop () {
      renderer.render(scene, camera)
      requestAnimationFrame(loop)
    }
    function onWindowResize () {
      window.addEventListener('resize', function () {
        width = window.innerWidth
        height = window.innerHeight

        camera.aspect = width / height;
        camera.updateProjectionMatrix()

        renderer.setSize(width, height)
      })
    }
  </script>
</body>
</html>